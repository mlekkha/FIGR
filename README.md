# FIGR

Fast Inference of Gene Regulation - A supervised classification-based
method for inferring dynamical models of gene regulatory networks.

**Version 0.1**

David Fehr, Manu, and Yen Lee Loh

University of North Dakota

2019-04-24

## ABOUT

FIGR infers the parameter values of differential equation models of gene
regulatory networks (GRNs). The coupled differential equations, called
*gene circuits*, represent gene product synthesis with a switch-like
function of regulator concentrations, product degradation as a first-order
process, and product transport as Fickian diffusion. See [Manu *et al*.
(2009) *PLoS Biology*](http://dx.doi.org/10.1371/journal.pbio.1000049) or
[Jaeger *et al*. (2004)
*Genetics*](http://dx.doi.org/10.1534/genetics.104.027334) for a
description of gene circuit models.

Currently, FIGR is capable of inferring gene circuit models in two kinds of
situations:

1. GRN in a single cell, with gene expression *time series* data in one or
   more conditions.

1. GRN in a 1D row of cells, with gene expression *time series* data from
   each cell and transport of gene product between cells via Fickian
   diffusion.

## QUICK START GUIDE

1. Download all files into the same directory.

1. Start MATLAB and either
    1. `cd` to the folder containing the files, OR
    1. use `addpath()` to add the directory to the MATLAB path.

1. On the MATLAB command line, run one of the example scripts provided, such as
   `example1_simple`.  The scripts print text in the Command Window and
   also pop-up a Figure window.

1. If desired, examine global variables generated by the scripts in the
   global workspace.  

1. If refining parameters using refineFIGRParams (e.g. in `example3_fly`) a
   large speedup can be realized by using the MEX-file. The code will
   automatically attempt to use the MEX, which are provided for 64-bit
   Linux, OS X, and Windows platforms. They can be recompiled by running
   `build_refineFIGRParams_MEX` on the MATLAB command line. 

## SCRIPTS, FUNCTIONS, AND FILES

### Top-level Scripts

Example script | Description
-------------- | -----------
`example1-simple.m` | Illustrate FIGR for simple toy model with only 2 genes
`example2-extreg.m` | Illustrate FIGR for toy model with 2 genes + 1 external regulator
`example3-fly.m` | Illustrate FIGR for *Drosophila* gap gene data set (4+3 genes, 58 nuclei, 9 timepoints)

### Core FIGR functions

Function | Description
-------- | -----------
`infer.m` | Core of FIGR. Given gene expression time series data, infer GRN parameters using binary classification
`refineFIGRParams.m` | Refine GRN obtained by classification (`infer()`) by minimizing the **objective function** (squared difference between ODE solutions and data)
`computeTrajs.m` | Given GRN parameters, initial conditions, and timepoints, solve gene circuit equations to compute gene expression trajectories 
`initChiSquare.m` | Returns a handle to a function that computes the objective function and also the value of the objective function for a particular GRN

### Internal FIGR functions

Function | Description
-------- | -----------
`RateofChange.m` | Evaluate the RHS of gene circuit differential equations. Called by `computeTrajs()`
`packParams.m` | Pack the GRN structure into a 1D vector
`unpackParams.m` | Unpack 1D parameter vector into GRN structure


### Utility FIGR functions

Function | Description
-------- | -----------
`build_refineFIGRParams_MEX.m` | Build a MEX-file for `refineFIGRParams()` for a considerable speed-up

### Binary files

Function | Description
-------- | -----------
`refineFIGRParams_mex.mexa64` | Linux 64-bit `refineFIGRParams()` MEX-file built on MATLAB R2018b
`refineFIGRParams_mex.mexmaci64` | OS X 64-bit `refineFIGRParams()` MEX-file built on MATLAB R2018b
`refineFIGRParams_mex.mexw64` | Windows 64-bit `refineFIGRParams()` MEX-file built on MATLAB R2018b

### Example data files

Function | Description
-------- | -----------
`fly_xntg.txt` | Input data for *Drosophila* gap gene problem (see `example3_fly.m`).
`fly_tt.txt` | Timepoints for *Drosophila* gap gene problem (see `example3_fly.m`).

## INPUT DATA FORMAT

Two input files are needed:

1.  List of timepoints (e.g. `fly_tt.txt`).
    First row states number of dimensions (2) of the timepoint array.
    Second and third rows state the number of elements in each dimension.
    Fourth row contains the time points.

1.  Gene expression data (e.g. `fly_xntg.txt`).
    First row states number of dimensions (3) of the gene expression data array.
    Second-fourth rows state the number of elements in each dimension.
    
    First dimension: space/cells.
    
    Second dimension: time.
    
    Third dimension: genes.

    Let the time points be t_1, ..., t_n.

    Let the genes be g_1, ..., g_m.

    Let x(t_i, g_j) be a row vector of the concentrations of the gene
    product g_j in each cell at timepoint t_i. Then, the concentration data
    are stored in each row (starting from the fifth) as follows:

    x(t_1, g_1)

    x(t_2, g_1)

    .

    .

    .

    x(t_n, g_1)

    x(t_1, g_2)

    .

    .

    .

    x(t_n, g_2)

    .

    .

    .

    x(t_1, g_m)

    .

    .

    .

    x(t_n, g_m)


    FIGR can also model situations where out of n genes, ne are external
    regulators, that is, they regulate the n-ne genes but are not regulated
    themselves. FIGR assumes that in the data, the external gene data will
    appear after the data of the regulated genes,, i.e.,

    Regulated genes | External regulators
    --------------- | -------------------
    g_1,...,g_{n-ne} | g_{n-ne+1},...,g_n

## USER-SET VARIABLES AND OPTIONS 

### User-set variables

Variable | Description | Possible values
-------- | ----------- | ---------------
`numGenes` | Number of non-external genes | >= 1 

There are three **global** options structures that control FIGR behavior.

### `opts`

Field | Description | Possible values
----- | ----------- | ---------------
`debug` | verbosity level | 0 (quiet) - 4 (very verbose)
`splinesmoothing` | Spline smoothing parameter for determining velocities | [0, 1]
`slopethresh` | Velocity threshold for determining on/off state | >0
`exprthresh` | Expression threshold for determining on/off state | >=0
`Rld_method` | Method for determining the kinetic parameters | `slope` or `kink` or `conc`
`Rld_tsafety` | Margin to exclude unreliable velocity estimates near maxima and minima of the time series | >=0 
`spatialsmoothing` | Spline smoothing parameter for identifying spatial expression domains and border positions | [0,1]
`minborder_expr_ratio` | Expression threshold above which points are included in fitting the kink equations, expressed as fraction of maximum domain expression | (0,1)
`synthesisfunction` | Switch-like function for synthesis | `synthesis_heaviside` or `synthesis_sigmoid_sqrt`
`ODEAbsTol` | Tolerance for MATLAB ODE solver | supported MATLAB solvers
`ODEsolver` | MATLAB ODE solver | supported MATLAB solvers

### `ODEopts`

Options passed on to MATLAB ODE solvers. Set using `odeset` command. See
MATLAB documentation for `odeset`.

### `optimopts`

Options passed on to MATLAB `fminsearch` for Nelder-Mead local search
during refinment in `refineFIGRParams`. Set using `optimset` command. See
MATLAB documentation for `optimset`.






README under construction. Stay tuned...
